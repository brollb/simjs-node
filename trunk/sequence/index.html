<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Sequence</title>
	<script src="lib/jquery-1.6.2.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/swfobject.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/downloadify.min.js" type="text/javascript" charset="utf-8"></script>

	<script src="lib/raphael-min2.js" type="text/javascript" charset="utf-8"></script>
	<script src="src/sequence.js" type="text/javascript" charset="utf-8"></script>
	<script src="src/actor.js" type="text/javascript" charset="utf-8"></script>
	
	<link rel="stylesheet" href="css/jquery-ui-1.8.16.custom.css" type="text/css" media="screen" title="no title" charset="utf-8">
	<link rel="stylesheet" href="css/sequence.css" type="text/css" media="screen" title="no title" charset="utf-8">
	<script type="text/javascript" charset="utf-8">
	$(function () {

		var width = 670,
				height = 920,
				canvas = Raphael('page', width, height);
				
		$('.comic').hide();
		$('.comic').each(function (index, el) {
			var id = $(this).attr('id');
			$('#links').append('<p><a href="#' + id + '" class="comic_link">' + id + '</a>');
		});
		$('.comic_link').click(function () {
			drawInput(canvas, width, height, $($(this).attr('href')).html(), $('#coord'));
			return false;
		});
		
		Downloadify.create('downloadify',{
			filename: function(){
				return "save.svg";
			},
			data: function(){ 
					var content = $('#page').html();
					content = content.replace(/href/g, 'xlink:href');
					content = content.replace(/<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"')
//					var uriContent = "data:image/svg+xml," + encodeURIComponent(content);
	//				var newWindow=window.open(uriContent, 'saved.sv');
	return content;

			},
//			onComplete: function(){ alert('Your File Has Been Saved!'); },
//			onCancel: function(){ alert('You have cancelled the saving of this file.'); },
//			onError: function(){ alert('You must put something in the File Contents or there will be nothing to save!'); },
			transparent: false,
			swf: 'lib/downloadify.swf',
			downloadImage: 'images/download.png',
			width: 100,
			height: 30,
			transparent: true,
			append: false
		});
		
	/*	$('#svg_save').click(function () {
			var content = $('#page').html();
			content = content.replace(/href/g, 'xlink:href');
			content = content.replace(/<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"')
			var uriContent = "data:image/svg+xml," + encodeURIComponent(content);
			var newWindow=window.open(uriContent, 'saved.sv');
		});*/
		

		drawInput(canvas, width, height, $('#leader-ring-sync-2').html(), $('#coord'))
		
	});

	</script>

</head>

<body id="sequence" onload="">
	<div id="page">
	</div>
	<div id="links">
		
	</div>
	
	<div id="leader-ring-sync-2" class="comic">
		define t images/stickman/sm_010_T.png 37 47 10 80 hidden
		define h1 circle Orange smile 15 40
		define h2 circle cyan smile 15 80
		define h3 circle Yellow smile 55 90
		define h4 circle lime smile 85 60
		define h5 circle #F9B7FF smile 55 25

		record ring_topology
		h1 to h2:
				- 0 0, curvy=1, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h2 to h3:
			- 0 0, curvy=1, angles=-30 180, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h3 to h4:
			- 0 0, curvy=1, angles=0 -90, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h4 to h5:
			- 0 0, curvy=1, angles=90 0, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h5 to h1:
			- 0 0, curvy=1, angles=180 20, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		done

		record ring_ids
		: 7
			- 7 40, type=rect
		: 5
			- 7 80, type=rect
		: 1
			- 50 80, type=rect
		: 4
			- 93 60, type=rect
		: 2
			- 65 20, type=rect

		done

		panel Hirshberg-Sinclair Algorithm
		- type=banner, color=#ccf
		
		rules
		sending rule
		
		1 send messages is both directions
		2 indicate how far the message should go
		3 when it has reached the max distance, the message must turn around and come back
		4 when the reversed are reached from both ends, double the distance and try again
		5 short circuit rule: when my id is greater than message; immediately return back and 
				say stop; the sender will not send any further		
		6 node that receives its forward direction message, is the leader
		

			
	</div>
	
	<div id="leader-ring-sync-1" class="comic">
		define t images/stickman/sm_010_T.png 37 47 10 80 hidden
		define h1 circle Orange smile 15 40
		define h2 circle cyan smile 15 80
		define h3 circle Yellow smile 55 90
		define h4 circle lime smile 85 60
		define h5 circle #F9B7FF smile 55 25
		
		record ring_topology
		h1 to h2:
				- 0 0, curvy=1, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h2 to h3:
			- 0 0, curvy=1, angles=-30 180, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h3 to h4:
			- 0 0, curvy=1, angles=0 -90, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h4 to h5:
			- 0 0, curvy=1, angles=90 0, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		h5 to h1:
			- 0 0, curvy=1, angles=180 20, packet=false, acolor=black, astyle=., awidth=1, ahead=false
		done
		
		record ring_ids
		: 7
			- 7 40, type=rect
		: 5
			- 7 80, type=rect
		: 1
			- 50 80, type=rect
		: 4
			- 93 60, type=rect
		: 2
			- 65 20, type=rect

		done
	

	panel LeLann, Chang-Roberts Algorithm
		- type=banner, color=#ccf


	panel
		- width=20
	show t
	move t 90 85
	rmove h5 0 -10
	replay ring_topology
	replay ring_ids
	#h1, h2, h3, h4, h5: We are ready
	t: Everybody: send your ID\nto your right neighbor
		- 50 50
			
	
	panel
		- width=20
	rmove h5 0 -10, h1 -5 0, h2 -5 0
	h1 to h2: ID=7
			- 24 58, color=Orange, pcolor=orange
	h2 to h3: ID=5
		- 18 95, angles=-30 180, color=cyan, pcolor=cyan
	h3 to h4: ID=1
		- 90 91, angles=0 -90, color=yellow, pcolor=yellow
	h4 to h5: ID=4
		- 85 15, angles=90 0, color=lime, pcolor=lime
	h5 to h1: ID=2
		- 26 12, angles=180 20, color=#F9B7FF, pcolor=#F9B7FF
	#h1, h2, h3, h4, h5: Done.\nBut what do we\ndo with them now?
	#	- 55 46
	
	
	
	panel
		- width=-40, clear=true
	show t
	t: Those of you who\nhave HIGHER ID\nthan what you received --
		- 56 22
	: drop that message
		- 49 49, merge=true
	show h4, h3
	mood h4 silent
	rmove h4 0 5
	h3 to h4: ID=1
		- 57 77, angles=0 -90, color=yellow, pcolor=yellow
	hide h3
	h4 to :
	: 4
		- 96 63, type=rect
	
	panel
	replay ring_ids
	mood h1 rolleyes, h2 medium, h3 medium, h4 rolleyes, h5 medium
	h3 to h4: ID=1
		- 90 91, angles=0 -90, color=yellow, pcolor=yellow
	h4 to :
	h5 to h1: ID=2
		- 26 12, angles=180 20, color=#F9B7FF, pcolor=#F9B7FF
	h1 to :
	h1, h4: He means us..
			- 52 48
	
	panel
		- width=-20, clear=true
	show t
	t: Those of you who\nhave LOWER ID\nthan what you received --
		- 56 22
	: forward that message
		- 49 49, merge=true
	show h2, h3, h4
	hide h2, h4
	mood h3 thumbsup
	h2 to h3: ID=5
		- 33 76, angles=-30 180, color=cyan, pcolor=cyan
	h3 to h4: ID=5
		- 90 91, angles=0 -90, color=cyan, pcolor=cyan
	: 1
	 - 54 75, type=rect
		

	panel 
		- width=20
	replay ring_ids
	h2 to h3: ID=7
		- 18 95, angles=-30 180, color=orange, pcolor=orange
	h3 to h4: ID=5
		- 90 91, angles=0 -90, color=cyan, pcolor=cyan
	h5 to h1: ID=4
		- 26 20, angles=180 20, color=lime, pcolor=lime
	h2, h3, h5: That's us
		- 49 55
	mood h1 medium, h2 rolleyes, h3 rolleyes, h4 medium, h5 rolleyes
	
	panel
		- width=-40, clear=true
	show t
	t: And keep on with it..
		
	panel Who drops in next round?
		- width=20
	replay ring_ids
	h5 to h1: ID=4
		- 26 20, angles=180 20, color=lime, pcolor=lime
	h1 to :
	h5: I forwarded 4's\nmessage previously..
		- 54 56
	h1: .. which I dropped now
		- 47 86

	panel .. And who forwards?
		- width=20	
	replay ring_ids
	h3 to h4: ID=7
		- 90 91, angles=0 -90, color=orange, pcolor=orange
	h4 to h5: ID=5
		- 85 15, angles=90 0, color=cyan, pcolor=cyan
	h3, h4: We do!
	
	panel After another round
	h4 to h5: ID=7
		- 85 15, angles=90 0, color=orange, pcolor=orange
	h5 to h1: ID=5
		- 26 20, angles=180 20, color=cyan, pcolor=cyan	
	h1 to :
	
	panel .. and another round

	h5 to h1: ID=7
		- 26 20, angles=180 20, color=orange, pcolor=orange	
	h1: I received my message!\nWhat does that mean?
		- 49 60
	
	panel
		- clear = true
	show t
	t: If you receive your own message
		- 50 19
	: you are the LEADER!!
		- 71 40, merge=true
	show h1
	move h1 80 80
	mood h1 cool
	h1: WOOHOO!
		- 45 74

	record removed
	panel Lets try this one..
		- width=20
	: 1
		- 7 40, type=rect
	: 2
		- 7 80, type=rect
	: 3
		- 50 80, type=rect
	: 4
		- 93 60, type=rect
	: 5
		- 65 20, type=rect
	h1 to h2:
			- 24 58, color=Orange, pcolor=orange
	h2 to h3:
		- 18 95, angles=-30 180, color=cyan, pcolor=cyan
	h3 to h4:
		- 90 91, angles=0 -90, color=yellow, pcolor=yellow
	h4 to h5:
		- 85 15, angles=90 0, color=lime, pcolor=lime
	h5 to h1:
		- 26 12, angles=180 20, color=#F9B7FF, pcolor=#F9B7FF
	h1 to h2:
		- 0 0, angles=-30 30, color=#F9B7FF, pcolor=#F9B7FF
	h2 to h3:
		- 0 0, angles=0 120, color=#F9B7FF, pcolor=#F9B7FF
	h3 to h4:
		- 0 0, angles=30 210, color=#F9B7FF, pcolor=#F9B7FF
	h4 to h5:
		- 0 0, angles=150 -30, color=#F9B7FF, pcolor=#F9B7FF
		done

	</div>
		
	<div class="comic" id="hdfs">
		define c images/computer2.jpg 34 33 100 10 80
		define n images/blade.png 45 20 100 80 40
		define d1 images/blade.png 45 20 100 40 90
		define d2 images/blade.png 45 20 100 60 80
		define d3 images/blade.png 45 20 100 80 90
		define u images/BluePerson.gif 30 30 100 20 70 hidden
		
		panel
			- clear = true, width=120, color=#faa
		: Hadoop\nDistributed\nFile\nSystem\n(HDFS)
			- 50 50, type = none
		
		panel
			- clear=true, width=60, color=#cfc
			: The\nCast
				- 50 50, type=none
		
		panel
			- width = 220
		n: I am NAMENODE.\nI coordinate everything
			- 71 13
		c: I am CLIENT.\nI read/write data
			- 23 30
		d1, d2, d3: We are DATANODES.\nWe store data
			- 60 60
		
		panel
			n: There is only\nONE of me
				- 64 13
			c: People sit in\nfront of me\n(there can be any\nnumber of me)
				- 22 30
			d1, d2, d3: There are MANY of us.\nSometimes even thousands!
				- 60 60
			
		panel Writing Data in HDFS Cluster
			- type=banner, color=#cfc
		
		panel Request from User
		show u
		hide d1 permanent, d2 permanent, d3 permanent, n permanent
		move c 70 88
		u: Please write 200 MB\ndata for me
			- 35 30
		c: Okay. I will see what\nI can do for you. But--
			- 71 55
		
		panel Block and Replication
		show u
		move c 20 78, u 70 88
		c: --are you not\nforgetting\nsomething?
			- 22 35
		u: Ah yes.. please:\na) divide the data\nin 128MB blocks\nb) copy each block\nin three places
			- 73 45
		
		panel
		show u
		move c 20 78, u 70 88
		c: A good client always knows\nthese two things: 
			- 56 18
		: BLOCKSIZE: large file is divided\nin blocks (usually 64 or 128MB)
			- 54 48, type=rect, color=#fc9
		: REPLICATION FACTOR:\nnumber of places each\nblock must be replicated\n(usually 3)
			- 64 81, type=rect, color=#fc9
		
		panel Divide file into blocks
		show n
		move n 41 40
		hide n
		: xxxxxxxxxxx\nxxxxxxxxxxx\nxxxxxxxxxxx\nxxxxxxxxxxx
			- 25 40, type=rect, color=#fcc
		n: xxxxxxxxxxx\nxxxxxxxxxxx\nxxxxxx
			- 79, 45, type=rect, color=#fcc, twidth=1
		n: xxxxxxxxxxx\nxxxxxxxxxxx\nxxxxxx
			- 79, 80, type=rect, color=#fcc, twidth=1
		
		panel Ask Namnode
		show n
		c: I will work on\nthe first block\nfirst
			- 25 40
		c to n: Please help me write\n128MB block with\nreplication 3
			- 71 79
		
		panel
			show n
			n: Need to find 3 datanodes\nfor this guy
				- 37 13
			: How do I do that?\nWill tell you some\nother time
				- 37 44, type=balloon, style=-
			n to c: Here are the addresses\n of three datanodes
				- 70 88
		
		panel Client starts writing data
				show d1 permanent, d2 permanent, d3 permanent
				c: I send my data to\nfirst datanode only
					- 50 32, angle=45
				c to d1:
					- 0 0, angles=90 90, curvy=40
		
		panel
		d1: While I am recieving\ndata, I forward the same\ndata to the next datanode
			- 50 22
		c to d1:
			- 0 0, angles=90 120, curvy=40
		d1 to d2: 
			- 0 0, angles = 90 120, curvy=40
			
		panel
		c to d1:
			- 0 0, angles=90 120, curvy=40
		d1 to d2: 
			- 0 0, angles = 90 120, curvy=40
		d2 to d3:
			- 0 0, angles = 90 90, curvy=40
		d2: I do the same\nwhat previous guy did
			- 30 18
		d3: I am the last\nin chain
			- 80 30
		
		panel TA..DA.. Replication Pipeline
		c to d1:
			- 0 0, angles=90 120, curvy=40
		d1 to d2: 
			- 0 0, angles = 90 120, curvy=40
		d2 to d3:
			- 0 0, angles = 90 90, curvy=40
		
		panel
		hide c
		show n permanent
		: Once all data (for\nthis block) is\nwritten to hard disk
			- 36 24
		d1 to n: Done
			- 24 60, angles=90 180 0
		d2 to n: Me too
			- 32 72, angles=90 225 0
		d3 to n: Me too
			- 90 74, angles=90 -90 90
		
		panel
		hide d1, d2, d3
		n: Block successfully stored\nand replicated in HDFS
			- 30 19, angle=180
		c: And I repeat the same\nsteps with remaining blocks
			- 59 63, angle=0
			
	</div>
	
	<div class="comic" id="dhcp">
		define A images/computer2.jpg 34 33 100 20 30
		define B images/computer2.jpg 34 33 100 10 45
		define C images/computer2.jpg 34 33 100 20 70
		define S images/server.png 64 74 50 80 50
		define T images/server.png 64 74 50 80 24 hidden

		panel 
			- clear = true, width = 140
		: Dynamic\nHost\nConfiguration\nProtocol\n(DHCP)
			- 50 50, type = none
		
	
		panel
			- width = 200
		A, B, C: We are hosts
			- 60 20
		C: I don't have IP Address :(
			- 67 85, angle=0
		: DHCP Server
			- 80 70, type=rect
		
		panel Dhcp discover
		C to S: DHCP_Discover
			- 70 90, angles = 0 180 90
		C to A: DHCP_Discover
			- 70 90, angles = 0 0 90
		C to B: DHCP_Discover
			- 70 90, angles = 0 0 90
		: Broadcast\nin the subnet
			- 60 25
		
		panel
		hide C, S
		A to : 
		B to :
		: All other hosts\nwill ignore the discover packet
			- 52 70
		
		panel
		hide A permanent, B permanent, C
		move S 80 70 permanent
		S: Address Table\n192.168.0.1 (used)\n192.168.0.2 (used)\n192.168.0.3 (free)\n192.168.0.4 (free)\n...
			- 30 50, type = rect, color=#cfc
		S: I need to find\none free address
			- 75 20
		
		
		panel DHCP Offer
		S: Address Table\n192.168.0.3 (offered)
			- 70 20, type=rect, color=#cfc
		S: I will mark\nthe address as "offered"
			- 30 39
		S to C: DHCP_Offer 192.168.0.3
			- 50 90
			
		panel Dhcp request
		show A, B
		C to A:
			- 0 0, angles = 0 0
		C to B:
			- 0 0, angles = 0 0
		C to S: DHCP_Request 192.168.0.3
			- 50 90, angles= 0 180 90
		A to :
		B to :
		: Also Broadcast
			- 70 30

		panel
		hide C
		S: Address Table\n192.168.0.1 (used)\n192.168.0.2 (used)\n192.168.0.3 (USED)\n192.168.0.4 (free)\n...
			- 30 50, type = rect, color=#cfc
		S: One more\naddress used
			- 75 20
		
		panel DHCP Ack
		S: Another happy client!\nI will now start a "lease" timer\nbut more on that some other time
			- 55 35, twidth=20
		S to C: DHCP_Ack 192.168.0.3
			- 50 90, angles = 180 0 90
			
		panel Two DHCP Servers. Client must select one of them
			- type=banner, color=#afa

		
		panel DHCP Discover
		show T permanent
		C to T: DHCP_Discover
			- 70 90
		C to S: DHCP_Discover
			- 70 90, angles=0 180 90
		: Reaches both\nservers
			- 30 30
		
		panel Both select an address each
		hide C
		T: Address Table:\n192.168.0.123 (offered)
			- 35 40, type = rect, color=#cfc
		S: Address Table:\n192.168.0.3 (offered)
			- 35 70, type = rect, color=#cfc
			
		panel Two offers to the client
		T to C: DHCP_Offer\n192.168.0.123
			- 25 30, angles=180 30 0
		S to C: DHCP_Offer\n192.168.0.3
			- 55 90, angles=180 -30 90

		panel Client selects one address
		C: I select\n192.168.0.3
			- 20 35
		C to T: DHCP_Request 192.168.0.3
			- 60 90, angles=20 180 90
		C to S: DHCP_Request 192.168.0.3
			- 60 90, angles=-20 180 90
		
		panel
		hide C
		T: I will put the address\nback in free pool
			- 28 15, angle=180
		: Address Table:\n192.168.0.123 (FREE)
			- 41 33, type = rect, color=#cfc, angle=180
		S: I will mark the address\nas used
			- 33 68, angle=180
		: Address Table:\n192.168.0.3 (USED)
			- 41 87, type = rect, color=#cfc, angle=180
		
		panel
		S to C: DHCP_Ack 192.168.0.3
			- 50 90, angles=180 0 90
done		


		say('T', 'Address Table:\n192.168.0.123 (FREE)', 
			35, 20, {type: 'rect', angles: [0, 180]});
		say('S', 'Address Table:\n192.168.0.3 (USED)', 
			35, 50, {type: 'rect', angles: [0, 180]});
		send('S', "C", "DHCP_Ack 192.168.0.3", 70, 90, {angles: [180, 0, 90]});

	</div>
	

	<p id="downloadify"></p>
	<input type="text" name="coord" value="" id="coord">

</body>
</html>